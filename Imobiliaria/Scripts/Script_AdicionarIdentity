/*
Deployment script for aspnet-Imobiliaria-C123FEEE-EAD4-4A4B-8522-319480FA5D0B

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "aspnet-Imobiliaria-C123FEEE-EAD4-4A4B-8522-319480FA5D0B"
:setvar DefaultFilePrefix "aspnet-Imobiliaria-C123FEEE-EAD4-4A4B-8522-319480FA5D0B"
:setvar DefaultDataPath "C:\Users\ma_al\AppData\Local\Microsoft\Microsoft SQL Server Local DB\Instances\mssqllocaldb\"
:setvar DefaultLogPath "C:\Users\ma_al\AppData\Local\Microsoft\Microsoft SQL Server Local DB\Instances\mssqllocaldb\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO

IF (SELECT OBJECT_ID('tempdb..#tmpErrors')) IS NOT NULL DROP TABLE #tmpErrors
GO
CREATE TABLE #tmpErrors (Error int)
GO
SET XACT_ABORT ON
GO
SET TRANSACTION ISOLATION LEVEL READ COMMITTED
GO
BEGIN TRANSACTION
GO
PRINT N'Dropping [dbo].[FK_Comodo_Vistoria_IdVistoria]...';


GO
ALTER TABLE [dbo].[Comodo] DROP CONSTRAINT [FK_Comodo_Vistoria_IdVistoria];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_Nota_Comodo_IdComodo]...';


GO
ALTER TABLE [dbo].[Nota] DROP CONSTRAINT [FK_Nota_Comodo_IdComodo];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_Imovel_Endereco_IdEndereco]...';


GO
ALTER TABLE [dbo].[Imovel] DROP CONSTRAINT [FK_Imovel_Endereco_IdEndereco];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_Imovel_AspNetUsers_IdUsuario]...';


GO
ALTER TABLE [dbo].[Imovel] DROP CONSTRAINT [FK_Imovel_AspNetUsers_IdUsuario];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_LogSolicitacao_AspNetUsers_IdVistoriador]...';


GO
ALTER TABLE [dbo].[LogSolicitacao] DROP CONSTRAINT [FK_LogSolicitacao_AspNetUsers_IdVistoriador];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_LogSolicitacao_AspNetUsers_IdSolicitador]...';


GO
ALTER TABLE [dbo].[LogSolicitacao] DROP CONSTRAINT [FK_LogSolicitacao_AspNetUsers_IdSolicitador];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_Medicao_Vistoria_IdVistoria]...';


GO
ALTER TABLE [dbo].[Medicao] DROP CONSTRAINT [FK_Medicao_Vistoria_IdVistoria];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_Solicitacao_AspNetUsers_IdVistoriador]...';


GO
ALTER TABLE [dbo].[Solicitacao] DROP CONSTRAINT [FK_Solicitacao_AspNetUsers_IdVistoriador];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_Solicitacao_AspNetUsers_IdSolicitador]...';


GO
ALTER TABLE [dbo].[Solicitacao] DROP CONSTRAINT [FK_Solicitacao_AspNetUsers_IdSolicitador];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[FK_Vistoria_Solicitacao_IdSolicitacao]...';


GO
ALTER TABLE [dbo].[Vistoria] DROP CONSTRAINT [FK_Vistoria_Solicitacao_IdSolicitacao];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Starting rebuilding table [dbo].[Comodo]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Comodo] (
    [Id]         INT             IDENTITY (1, 1) NOT NULL,
    [Nome]       NVARCHAR (200)  NOT NULL,
    [Imagem]     VARBINARY (MAX) NULL,
    [Ativo]      BIT             NOT NULL,
    [CorTeto]    TINYINT         NOT NULL,
    [CorParede]  TINYINT         NOT NULL,
    [IdVistoria] INT             NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Comodo1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Comodo])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Comodo] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Comodo] ([Id], [Nome], [Imagem], [Ativo], [CorTeto], [CorParede], [IdVistoria])
        SELECT   [Id],
                 [Nome],
                 [Imagem],
                 [Ativo],
                 [CorTeto],
                 [CorParede],
                 [IdVistoria]
        FROM     [dbo].[Comodo]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Comodo] OFF;
    END

DROP TABLE [dbo].[Comodo];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Comodo]', N'Comodo';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Comodo1]', N'PK_Comodo', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Starting rebuilding table [dbo].[Endereco]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Endereco] (
    [Id]     INT            IDENTITY (1, 1) NOT NULL,
    [Rua]    NVARCHAR (256) NOT NULL,
    [Cep]    NVARCHAR (10)  NOT NULL,
    [Bairro] NVARCHAR (256) NOT NULL,
    [Cidade] NVARCHAR (256) NOT NULL,
    [Ativo]  BIT            NOT NULL,
    [Numero] NVARCHAR (10)  NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Endereco1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Endereco])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Endereco] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Endereco] ([Id], [Rua], [Cep], [Bairro], [Cidade], [Ativo], [Numero])
        SELECT   [Id],
                 [Rua],
                 [Cep],
                 [Bairro],
                 [Cidade],
                 [Ativo],
                 [Numero]
        FROM     [dbo].[Endereco]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Endereco] OFF;
    END

DROP TABLE [dbo].[Endereco];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Endereco]', N'Endereco';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Endereco1]', N'PK_Endereco', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Starting rebuilding table [dbo].[Imovel]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Imovel] (
    [Id]         INT            IDENTITY (1, 1) NOT NULL,
    [Area]       INT            NOT NULL,
    [Ativo]      BIT            NOT NULL,
    [Idade]      BIGINT         NOT NULL,
    [Seguro]     BIT            NOT NULL,
    [IdEndereco] INT            NOT NULL,
    [IdUsuario]  NVARCHAR (450) NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Imovel1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Imovel])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Imovel] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Imovel] ([Id], [Area], [Ativo], [Idade], [Seguro], [IdEndereco], [IdUsuario])
        SELECT   [Id],
                 [Area],
                 [Ativo],
                 [Idade],
                 [Seguro],
                 [IdEndereco],
                 [IdUsuario]
        FROM     [dbo].[Imovel]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Imovel] OFF;
    END

DROP TABLE [dbo].[Imovel];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Imovel]', N'Imovel';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Imovel1]', N'PK_Imovel', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Starting rebuilding table [dbo].[LogSolicitacao]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_LogSolicitacao] (
    [Id]              INT            IDENTITY (1, 1) NOT NULL,
    [DataAtualizacao] DATETIME2 (7)  NOT NULL,
    [DataVistoria]    DATETIME2 (7)  NOT NULL,
    [Descricao]       NVARCHAR (MAX) NOT NULL,
    [IdVistoriador]   NVARCHAR (450) NOT NULL,
    [IdSolicitador]   NVARCHAR (450) NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_LogSolicitacao1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[LogSolicitacao])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_LogSolicitacao] ON;
        INSERT INTO [dbo].[tmp_ms_xx_LogSolicitacao] ([Id], [DataAtualizacao], [DataVistoria], [Descricao], [IdVistoriador], [IdSolicitador])
        SELECT   [Id],
                 [DataAtualizacao],
                 [DataVistoria],
                 [Descricao],
                 [IdVistoriador],
                 [IdSolicitador]
        FROM     [dbo].[LogSolicitacao]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_LogSolicitacao] OFF;
    END

DROP TABLE [dbo].[LogSolicitacao];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_LogSolicitacao]', N'LogSolicitacao';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_LogSolicitacao1]', N'PK_LogSolicitacao', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Starting rebuilding table [dbo].[Medicao]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Medicao] (
    [Id]          INT            IDENTITY (1, 1) NOT NULL,
    [Agua]        NVARCHAR (MAX) NOT NULL,
    [Energia]     NVARCHAR (MAX) NOT NULL,
    [Extintor]    BIT            NOT NULL,
    [GasEncanado] BIT            NOT NULL,
    [Ativo]       BIT            NOT NULL,
    [IdVistoria]  INT            NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Medicao1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Medicao])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Medicao] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Medicao] ([Id], [Agua], [Energia], [Extintor], [GasEncanado], [Ativo], [IdVistoria])
        SELECT   [Id],
                 [Agua],
                 [Energia],
                 [Extintor],
                 [GasEncanado],
                 [Ativo],
                 [IdVistoria]
        FROM     [dbo].[Medicao]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Medicao] OFF;
    END

DROP TABLE [dbo].[Medicao];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Medicao]', N'Medicao';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Medicao1]', N'PK_Medicao', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Starting rebuilding table [dbo].[Nota]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Nota] (
    [Id]        INT             IDENTITY (1, 1) NOT NULL,
    [Titulo]    NVARCHAR (200)  NOT NULL,
    [Descricao] NVARCHAR (MAX)  NOT NULL,
    [Imagem]    VARBINARY (MAX) NULL,
    [IdComodo]  INT             NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Nota1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Nota])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Nota] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Nota] ([Id], [Titulo], [Descricao], [Imagem], [IdComodo])
        SELECT   [Id],
                 [Titulo],
                 [Descricao],
                 [Imagem],
                 [IdComodo]
        FROM     [dbo].[Nota]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Nota] OFF;
    END

DROP TABLE [dbo].[Nota];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Nota]', N'Nota';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Nota1]', N'PK_Nota', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Starting rebuilding table [dbo].[Solicitacao]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Solicitacao] (
    [Id]              INT            IDENTITY (1, 1) NOT NULL,
    [DataSolicitacao] DATETIME2 (7)  NOT NULL,
    [DataVistoria]    DATETIME2 (7)  NOT NULL,
    [Ativo]           BIT            NOT NULL,
    [IdVistoriador]   NVARCHAR (450) NOT NULL,
    [IdSolicitador]   NVARCHAR (450) NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Solicitacao1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Solicitacao])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Solicitacao] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Solicitacao] ([Id], [DataSolicitacao], [DataVistoria], [Ativo], [IdVistoriador], [IdSolicitador])
        SELECT   [Id],
                 [DataSolicitacao],
                 [DataVistoria],
                 [Ativo],
                 [IdVistoriador],
                 [IdSolicitador]
        FROM     [dbo].[Solicitacao]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Solicitacao] OFF;
    END

DROP TABLE [dbo].[Solicitacao];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Solicitacao]', N'Solicitacao';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Solicitacao1]', N'PK_Solicitacao', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Starting rebuilding table [dbo].[Vistoria]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Vistoria] (
    [Id]            INT           IDENTITY (1, 1) NOT NULL,
    [DataInicio]    DATETIME2 (7) NULL,
    [DataFim]       DATETIME2 (7) NULL,
    [Ativo]         BIT           NOT NULL,
    [IdSolicitacao] INT           NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Vistoria1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Vistoria])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Vistoria] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Vistoria] ([Id], [DataInicio], [DataFim], [Ativo], [IdSolicitacao])
        SELECT   [Id],
                 [DataInicio],
                 [DataFim],
                 [Ativo],
                 [IdSolicitacao]
        FROM     [dbo].[Vistoria]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Vistoria] OFF;
    END

DROP TABLE [dbo].[Vistoria];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Vistoria]', N'Vistoria';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Vistoria1]', N'PK_Vistoria', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_Comodo_Vistoria_IdVistoria]...';


GO
ALTER TABLE [dbo].[Comodo] WITH NOCHECK
    ADD CONSTRAINT [FK_Comodo_Vistoria_IdVistoria] FOREIGN KEY ([IdVistoria]) REFERENCES [dbo].[Vistoria] ([Id]) ON DELETE CASCADE;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_Nota_Comodo_IdComodo]...';


GO
ALTER TABLE [dbo].[Nota] WITH NOCHECK
    ADD CONSTRAINT [FK_Nota_Comodo_IdComodo] FOREIGN KEY ([IdComodo]) REFERENCES [dbo].[Comodo] ([Id]) ON DELETE CASCADE;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_Imovel_Endereco_IdEndereco]...';


GO
ALTER TABLE [dbo].[Imovel] WITH NOCHECK
    ADD CONSTRAINT [FK_Imovel_Endereco_IdEndereco] FOREIGN KEY ([IdEndereco]) REFERENCES [dbo].[Endereco] ([Id]) ON DELETE CASCADE;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_Imovel_AspNetUsers_IdUsuario]...';


GO
ALTER TABLE [dbo].[Imovel] WITH NOCHECK
    ADD CONSTRAINT [FK_Imovel_AspNetUsers_IdUsuario] FOREIGN KEY ([IdUsuario]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_LogSolicitacao_AspNetUsers_IdVistoriador]...';


GO
ALTER TABLE [dbo].[LogSolicitacao] WITH NOCHECK
    ADD CONSTRAINT [FK_LogSolicitacao_AspNetUsers_IdVistoriador] FOREIGN KEY ([IdVistoriador]) REFERENCES [dbo].[AspNetUsers] ([Id]);


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_LogSolicitacao_AspNetUsers_IdSolicitador]...';


GO
ALTER TABLE [dbo].[LogSolicitacao] WITH NOCHECK
    ADD CONSTRAINT [FK_LogSolicitacao_AspNetUsers_IdSolicitador] FOREIGN KEY ([IdSolicitador]) REFERENCES [dbo].[AspNetUsers] ([Id]);


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_Medicao_Vistoria_IdVistoria]...';


GO
ALTER TABLE [dbo].[Medicao] WITH NOCHECK
    ADD CONSTRAINT [FK_Medicao_Vistoria_IdVistoria] FOREIGN KEY ([IdVistoria]) REFERENCES [dbo].[Vistoria] ([Id]);


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_Solicitacao_AspNetUsers_IdVistoriador]...';


GO
ALTER TABLE [dbo].[Solicitacao] WITH NOCHECK
    ADD CONSTRAINT [FK_Solicitacao_AspNetUsers_IdVistoriador] FOREIGN KEY ([IdVistoriador]) REFERENCES [dbo].[AspNetUsers] ([Id]);


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_Solicitacao_AspNetUsers_IdSolicitador]...';


GO
ALTER TABLE [dbo].[Solicitacao] WITH NOCHECK
    ADD CONSTRAINT [FK_Solicitacao_AspNetUsers_IdSolicitador] FOREIGN KEY ([IdSolicitador]) REFERENCES [dbo].[AspNetUsers] ([Id]);


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[FK_Vistoria_Solicitacao_IdSolicitacao]...';


GO
ALTER TABLE [dbo].[Vistoria] WITH NOCHECK
    ADD CONSTRAINT [FK_Vistoria_Solicitacao_IdSolicitacao] FOREIGN KEY ([IdSolicitacao]) REFERENCES [dbo].[Solicitacao] ([Id]);


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO

IF EXISTS (SELECT * FROM #tmpErrors) ROLLBACK TRANSACTION
GO
IF @@TRANCOUNT>0 BEGIN
PRINT N'The transacted portion of the database update succeeded.'
COMMIT TRANSACTION
END
ELSE PRINT N'The transacted portion of the database update failed.'
GO
DROP TABLE #tmpErrors
GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[Comodo] WITH CHECK CHECK CONSTRAINT [FK_Comodo_Vistoria_IdVistoria];

ALTER TABLE [dbo].[Nota] WITH CHECK CHECK CONSTRAINT [FK_Nota_Comodo_IdComodo];

ALTER TABLE [dbo].[Imovel] WITH CHECK CHECK CONSTRAINT [FK_Imovel_Endereco_IdEndereco];

ALTER TABLE [dbo].[Imovel] WITH CHECK CHECK CONSTRAINT [FK_Imovel_AspNetUsers_IdUsuario];

ALTER TABLE [dbo].[LogSolicitacao] WITH CHECK CHECK CONSTRAINT [FK_LogSolicitacao_AspNetUsers_IdVistoriador];

ALTER TABLE [dbo].[LogSolicitacao] WITH CHECK CHECK CONSTRAINT [FK_LogSolicitacao_AspNetUsers_IdSolicitador];

ALTER TABLE [dbo].[Medicao] WITH CHECK CHECK CONSTRAINT [FK_Medicao_Vistoria_IdVistoria];

ALTER TABLE [dbo].[Solicitacao] WITH CHECK CHECK CONSTRAINT [FK_Solicitacao_AspNetUsers_IdVistoriador];

ALTER TABLE [dbo].[Solicitacao] WITH CHECK CHECK CONSTRAINT [FK_Solicitacao_AspNetUsers_IdSolicitador];

ALTER TABLE [dbo].[Vistoria] WITH CHECK CHECK CONSTRAINT [FK_Vistoria_Solicitacao_IdSolicitacao];


GO
PRINT N'Update complete.';


GO
